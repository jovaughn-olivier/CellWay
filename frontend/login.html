<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign In</title>
  <link rel="stylesheet" href="styles.css">
  <script src="menuLoader.js" defer></script>
</head>
<body class="login-page">
  <div id="menu-container"></div>
  <h1>Sign In</h1>
  <div class="form-container">
    <form onsubmit="return handleSubmit(event)">
      <div class="input-group">
        <input type="text" id="username" placeholder="Email/Username">
        <div class="error-message" id="usernameError"></div>
      </div>
      <div class="input-group">
        <input type="password" id="password" placeholder="Password">
        <div class="error-message" id="passwordError"></div>
      </div>
      <div class="button-container">
        <button type="submit" class="login-button">Login</button>
        <button type="button" class="signup-button" onclick="handleSignup()">Sign Up</button>
      </div>
    </form>
    <div id="resetPasswordContainer" style="display: none;">
      <p><a href="#" onclick="resetPassword()">Click to reset password</a></p>
    </div>
  </div>

  <script>
    let failedAttempts = 0;

    function handleSubmit(e) {
      e.preventDefault();
      const username = document.getElementById("username");
      const password = document.getElementById("password");

      document.getElementById("usernameError").textContent = "";
      document.getElementById("passwordError").textContent = "";

      if (!username.value.trim()) {
        document.getElementById("usernameError").textContent = "Username is required.";
        return false;
      }
      if (!password.value.trim()) {
        document.getElementById("passwordError").textContent = "Password is required.";
        return false;
      }

      if (!isPasswordValid(password.value)) {
        document.getElementById("passwordError").textContent = "Incorrect password.";
        password.value = ""; // Clear the password
        failedAttempts++;

        if (failedAttempts === 4) document.getElementById("resetPasswordContainer").style.display = "block";
        if (failedAttempts >= 7) return lockAccount();

        return false;
      }

      alert("Sign-in Successful!");
      window.location.href = "homepage.html";
      return false;
    }

    function handleSignup() {
      const username = document.getElementById("username");
      const password = document.getElementById("password");

      document.getElementById("usernameError").textContent = username.value.trim() ? "" : "Username is required.";
      document.getElementById("passwordError").textContent = password.value.trim() ? "" : "Password is required.";

      if (username.value.trim() && password.value.trim()) {
        alert("Account successfully created!");
        window.location.href = "homepage.html";
      }
    }

    function isPasswordValid(password) {
      return password === "password123"; // Replace with actual validation
    }

    function resetPassword() {
      alert("Redirecting to password reset...");
      window.location.href = "reset-password.html";
    }

    function lockAccount() {
      alert("This account has been locked. Check your email for instructions.");
      sendLockEmail();
      document.getElementById("username").value = ""; // Clear the username only on lockout
      document.getElementById("password").value = ""; // Clear the password
      return false;
    }

    function sendLockEmail() {
      console.log("Sending account lock email...");
    }

    document.querySelectorAll("#username, #password").forEach(el =>
      el.addEventListener("keypress", (e) => { if (e.key === "Enter") handleSubmit(e); })
    );
  </script>
</body>
</html>
